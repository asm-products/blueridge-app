{% extends "app/base.html" %}
{% block title %}Todos{% endblock %}
{% block content %}
<div id="app-todos" class="container app-container">
	{% include "app/sections/nav.html" %}
  <div class="app-filter-message alert alert-error">
    <button type="button" class="close" data-dismiss="alert">&times;</button>
    You are now in Solo Mode. Click 'Show Everyone' to see everyone again.
  </div>
  <div class="panel">
    {% if todos == null %}
    <div class="loading">
      <h2>Whoops! There are no To-dos in the projects you've selected.</h2>
      <a href="/app/projects/" class="btn btn-success btn-large" style="margin-bottom:2em">Change Selected Projects</a>
    </div>
    {% else %}
    <div class="app-todo-controls row-fluid">
      <div class="span9">
        <div class="btn-toolbar">
          <div class="btn-group mixsorters">
            <button class="btn btn-mini sort active" data-sort="data-duedate" data-order="desc">Oldest First</button>
            <button class="btn btn-mini sort" data-sort="data-duedate" data-order="asc">Newest First</button>
          </div>
        </div>
      </div>
      <div class="span3">
        <div class="btn-toolbar">
          <div class="btn-group mixfilters">
            <button class="btn btn-mini filter active" data-filter="all" id="app-assignee-filter-show-all">Everyone</button>
            <button class="btn btn-mini filter" data-filter="{{user.name|e('html')|replace({' ':''})|lower}}" id="app-assignee-filter-show-me">Me</button>
            <button class="btn btn-mini filter" data-filter="unassigned" id="app-assignee-filter-show-unassigned">Unassigned</button>
          </div>
          <div class="btn-group muted-people">
          </div>
        </div>
      </div>
    </div>
    <div id="todos">
      {% for todo in todos %}
      <div class="app-todo-list-item row-fluid mix {{todo.assignee.name|e('html')|replace({' ':''})|lower}}" data-duedate="{{todo.due_date|date('U')}}">
        <div class="span3 app-todo-duedate">
          {% if todo.due_on == null %}<span class="app-alert-warning">None</span>{% else %} {{todo.due_on|date('m/d/Y')}}{% endif %} {% if todo.overdue_by>0 %}<span class="app-alert-warning app-todo-overdue">{{todo.overdue_by|e('html')}} days</span>{% endif %}
        </div>
        <div class="span6 app-todo-content">
          <a class="app-todo-title" href="{{todo.href}}" target="_blank">{{todo.content|e('html')}}</a>
          <span class="app-todo-meta">{{todo.parent.list_name|e('html')}} | {{todo.parent.project_name|e('html')}}</span>
        </div>
        <div class="span3 app-todo-owner">
          <span class="app-assignee{% if todo.assignee.name == 'Unassigned' %} app-assignee-warning{% endif %}">
            <span class="app-assignee-name" data-nametoken="{{todo.assignee.name|e('html')|replace({' ':''})|lower}}">{{todo.assignee.name|e('html')}}</span>
            <span class="app-assignee-mutesolo app-filter-assignee filter" data-filter="{{todo.assignee.name|e('html')|replace({' ':''})|lower}}"><i class="icon-zoom-in" title="Solo"></i></span>
            <!-- <span class="app-assignee-mutesolo app-mute-assignee" data-filter="{{todo.assignee.name|e('html')|replace({' ':''})|lower}}"><i class="icon-ban-circle" title="Mute"></i></span> -->
          </span>
        </div>
      </div>
      {% endfor %}
    </div>
    <div class="row-fluid subcontrols">
      <div class="span12">
        <div class="btn-toolbar">
          <div class="btn-group pull-right">
            <button class="btn btn-mini" href="/app/export/csv/"><i class="icon-download-alt"></i> Export CSV</button>
          </div>
        </div>
      </div>
    </div>
    {% endif %}
  </div>


</div>
{% include "app/sections/footer.html" %}
{% endblock %}
{% block js %}
<script type="text/javascript" src="/js/app.behavior.js"></script>
{% endblock %}